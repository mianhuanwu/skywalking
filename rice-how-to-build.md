# 如何构建

原始文档：
docs/en/guides/How-to-build.md

## 本地步骤
```text
git clone https://github.com/apache/skywalking.git
cd skywalking/
git checkout rice-v8.7
(这个时候：apm-protocol/apm-network/src/main/proto 目录下是没有文件的)
git submodule init
git submodule update
(这个时候：apm-protocol/apm-network/src/main/proto 目录下就应该有文件了)
(记得忽略前端项目构建，把apm-webapp的pom.xml文件下的"frontend-maven-plugin"这个插件中的executions全部注释掉)
./mvnw clean package -DskipTests
```

执行之后可看到 BUILD SUCCESS
```shell

main:
     [copy] Copying 1 file to /Users/rice/myspace/developer/codes/rice-sky/skywalking/dist
[INFO] Executed tasks
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary for apm 8.7.0:
[INFO] 
[INFO] apm ................................................ SUCCESS [  2.823 s]
[INFO] apm-commons ........................................ SUCCESS [  0.140 s]
[INFO] apm-util ........................................... SUCCESS [  3.775 s]
[INFO] apm-datacarrier .................................... SUCCESS [  3.959 s]
[INFO] apm-protocol ....................................... SUCCESS [  0.107 s]
[INFO] apm-network ........................................ SUCCESS [  8.946 s]
[INFO] apm-sniffer ........................................ SUCCESS [  0.074 s]
[INFO] apm-agent-core ..................................... SUCCESS [ 26.404 s]
[INFO] apm-agent .......................................... SUCCESS [  6.298 s]
[INFO] apm-test-tools ..................................... SUCCESS [  1.083 s]
[INFO] apm-sdk-plugin ..................................... SUCCESS [  0.365 s]
[INFO] dubbo-plugin ....................................... SUCCESS [  1.622 s]
[INFO] jdbc-commons ....................................... SUCCESS [  3.349 s]
[INFO] apm-httpclient-commons ............................. SUCCESS [  0.733 s]
[INFO] httpclient-4.x-plugin .............................. SUCCESS [  1.789 s]
[INFO] jedis-2.x-plugin ................................... SUCCESS [  1.889 s]
[INFO] redisson-3.x-plugin ................................ SUCCESS [  1.658 s]
[INFO] tomcat-7.x-8.x-plugin .............................. SUCCESS [  1.518 s]
[INFO] motan-plugin ....................................... SUCCESS [  1.484 s]
[INFO] mongodb-plugin ..................................... SUCCESS [  1.662 s]
[INFO] mongodb-plugin ..................................... SUCCESS [  1.590 s]
[INFO] apm-feign-default-http-9.x-plugin .................. SUCCESS [  1.488 s]
[INFO] okhttp-common ...................................... SUCCESS [  0.749 s]
[INFO] okhttp-3.x-plugin .................................. SUCCESS [  1.339 s]
[INFO] okhttp-4.x-plugin .................................. SUCCESS [  0.662 s]
[INFO] apm-sdk-plugin ..................................... SUCCESS [  0.100 s]
[INFO] async-annotation-plugin ............................ SUCCESS [  0.686 s]
[INFO] spring-commons ..................................... SUCCESS [  0.653 s]
[INFO] concurrent-util-4.x-plugin ......................... SUCCESS [  0.847 s]
[INFO] resttemplate-4.3.x-plugin .......................... SUCCESS [  1.400 s]
[INFO] mvc-annotation-commons ............................. SUCCESS [  1.011 s]
[INFO] mvc-annotation-4.x-plugin .......................... SUCCESS [  1.963 s]
[INFO] spring-cloud ....................................... SUCCESS [  0.091 s]
[INFO] netflix-plugins .................................... SUCCESS [  0.117 s]
[INFO] spring-cloud-feign-1.x-plugin ...................... SUCCESS [  0.691 s]
[INFO] apm-spring-cloud-feign-2.x-plugin .................. SUCCESS [  0.642 s]
[INFO] mvc-annotation-3.x-plugin .......................... SUCCESS [  1.307 s]
[INFO] core-patch ......................................... SUCCESS [  1.601 s]
[INFO] mvc-annotation-5.x-plugin .......................... SUCCESS [  0.985 s]
[INFO] kafka-commons ...................................... SUCCESS [  0.661 s]
[INFO] apm-spring-kafka-1.x-plugin ........................ SUCCESS [  0.748 s]
[INFO] apm-spring-kafka-2.x-plugin ........................ SUCCESS [  0.702 s]
[INFO] scheduled-annotation-plugin ........................ SUCCESS [  0.739 s]
[INFO] spring-webflux-5.x-webclient-plugin ................ SUCCESS [  0.751 s]
[INFO] struts2-2.x-plugin ................................. SUCCESS [  1.475 s]
[INFO] apm-sdk-plugin ..................................... SUCCESS [  0.086 s]
[INFO] http-1.x-plugin .................................... SUCCESS [  1.242 s]
[INFO] mvc-annotation-1.x-plugin .......................... SUCCESS [  0.660 s]
[INFO] jetty-plugin ....................................... SUCCESS [  0.075 s]
[INFO] jetty-client-9.x-plugin ............................ SUCCESS [  1.314 s]
[INFO] jetty-server-9.x-plugin ............................ SUCCESS [  1.406 s]
[INFO] jetty-client-9.0-plugin ............................ SUCCESS [  1.283 s]
[INFO] spymemcached-2.x-plugin ............................ SUCCESS [  1.223 s]
[INFO] sharding-sphere-3.x-plugin ......................... SUCCESS [  1.734 s]
[INFO] sharding-sphere-4.0.x-plugin ....................... SUCCESS [  1.548 s]
[INFO] sharding-sphere-4.1.0-plugin ....................... SUCCESS [  1.643 s]
[INFO] shardingsphere-5.0.0-beta-plugin ................... SUCCESS [  2.751 s]
[INFO] xmemcached-2.x-plugin .............................. SUCCESS [  1.365 s]
[INFO] grpc-1.x-plugin .................................... SUCCESS [  1.214 s]
[INFO] apm-mysql-commons .................................. SUCCESS [  1.545 s]
[INFO] mysql-5.x-plugin ................................... SUCCESS [  1.346 s]
[INFO] mysql-6.x-plugin ................................... SUCCESS [  0.756 s]
[INFO] mysql-8.x-plugin ................................... SUCCESS [  1.396 s]
[INFO] h2-1.x-plugin ...................................... SUCCESS [  0.727 s]
[INFO] postgresql-8.x-plugin .............................. SUCCESS [  0.955 s]
[INFO] rocketMQ-3.x-plugin ................................ SUCCESS [  1.592 s]
[INFO] rocketMQ-4.x-plugin ................................ SUCCESS [  1.487 s]
[INFO] elastic-job-2.x-plugin ............................. SUCCESS [  1.341 s]
[INFO] elasticjob-3.x-plugin .............................. SUCCESS [  0.933 s]
[INFO] apm-mongodb-2.x-plugin ............................. SUCCESS [  2.125 s]
[INFO] httpasyncclient-4.x-plugin ......................... SUCCESS [  1.524 s]
[INFO] apm-kafka-plugin ................................... SUCCESS [  1.700 s]
[INFO] apm-sdk-plugin ..................................... SUCCESS [  0.093 s]
[INFO] servicecomb-java-chassis-0.x-plugin ................ SUCCESS [  2.375 s]
[INFO] servicecomb-java-chassis-1.x-plugin ................ SUCCESS [  1.937 s]
[INFO] apm-hystrix-1.x-plugin ............................. SUCCESS [  1.591 s]
[INFO] sofarpc-plugin ..................................... SUCCESS [  1.555 s]
[INFO] activemq-5.x-plugin ................................ SUCCESS [  1.505 s]
[INFO] elasticsearch-5.x-plugin ........................... SUCCESS [  1.659 s]
[INFO] elasticsearch-6.x-plugin ........................... SUCCESS [  3.216 s]
[INFO] elasticsearch-7.x-plugin ........................... SUCCESS [  1.386 s]
[INFO] undertow-plugins ................................... SUCCESS [  0.102 s]
[INFO] undertow-2.x-plugin ................................ SUCCESS [  2.374 s]
[INFO] rabbitmq-5.x-plugin ................................ SUCCESS [  1.723 s]
[INFO] apm-dubbo-conflict-path ............................ SUCCESS [  0.726 s]
[INFO] canal-1.x-plugin ................................... SUCCESS [  1.562 s]
[INFO] dubbo-2.7.x-plugin ................................. SUCCESS [  1.388 s]
[INFO] apm-dubbo-2.7.x-conflict-path ...................... SUCCESS [  0.731 s]
[INFO] vertx-plugins ...................................... SUCCESS [  0.098 s]
[INFO] vertx-core-3.x-plugin .............................. SUCCESS [  1.537 s]
[INFO] resteasy-plugin .................................... SUCCESS [  0.084 s]
[INFO] apm-resteasy-server-3.x-plugin ..................... SUCCESS [  1.485 s]
[INFO] solrj-7.x-plugin ................................... SUCCESS [  1.849 s]
[INFO] apm-cassandra-java-driver-3.x-plugin ............... SUCCESS [  1.583 s]
[INFO] light4j-plugins .................................... SUCCESS [  0.095 s]
[INFO] light4j-plugin ..................................... SUCCESS [  1.406 s]
[INFO] apm-pulsar-plugin .................................. SUCCESS [  2.724 s]
[INFO] netty-socketio-plugin .............................. SUCCESS [  1.769 s]
[INFO] armeria-0.84.x-plugin .............................. SUCCESS [  2.075 s]
[INFO] armeria-0.85.x-plugin .............................. SUCCESS [  1.057 s]
[INFO] httpclient-3.x-plugin .............................. SUCCESS [  1.010 s]
[INFO] play-2.x-plugin .................................... SUCCESS [  2.021 s]
[INFO] lettuce-5.x-plugin ................................. SUCCESS [  1.818 s]
[INFO] apm-avro-plugin .................................... SUCCESS [  2.045 s]
[INFO] apm-finagle-6.25.x-plugin .......................... SUCCESS [ 10.965 s]
[INFO] quasar-plugin ...................................... SUCCESS [  0.715 s]
[INFO] mariadb-2.x-plugin ................................. SUCCESS [  1.500 s]
[INFO] apm-influxdb-2.x-plugin ............................ SUCCESS [  1.458 s]
[INFO] baidu-brpc-plugin .................................. SUCCESS [  1.024 s]
[INFO] hbase-1.x-2.x-plugin ............................... SUCCESS [  2.067 s]
[INFO] graphql-plugin ..................................... SUCCESS [  0.154 s]
[INFO] graphql-8.x-plugin ................................. SUCCESS [  0.674 s]
[INFO] graphql-9.x-plugin ................................. SUCCESS [  0.681 s]
[INFO] graphql-12.x-plugin ................................ SUCCESS [  0.737 s]
[INFO] xxl-job-2.x-plugin ................................. SUCCESS [  0.814 s]
[INFO] apm-thrift-plugin .................................. SUCCESS [  1.039 s]
[INFO] apm-asynchttpclient-2.x-plugin ..................... SUCCESS [  1.575 s]
[INFO] dbcp-2.x-plugin .................................... SUCCESS [  0.659 s]
[INFO] apm-mssql-commons .................................. SUCCESS [  0.788 s]
[INFO] mssql-jtds-1.x-plugin .............................. SUCCESS [  0.759 s]
[INFO] mssql-jdbc-plugin .................................. SUCCESS [  0.669 s]
[INFO] cxf-3.x-plugin ..................................... SUCCESS [  0.968 s]
[INFO] jsonrpc4j-1.x-plugin ............................... SUCCESS [  1.539 s]
[INFO] neo4j-4.x-plugin ................................... SUCCESS [  1.545 s]
[INFO] apm-application-toolkit ............................ SUCCESS [  0.054 s]
[INFO] apm-toolkit-trace .................................. SUCCESS [  0.642 s]
[INFO] apm-toolkit-activation ............................. SUCCESS [  0.074 s]
[INFO] apm-toolkit-kafka-activation ....................... SUCCESS [  0.645 s]
[INFO] apm-toolkit-log4j-1.x .............................. SUCCESS [  0.551 s]
[INFO] apm-toolkit-logging-common ......................... SUCCESS [  0.940 s]
[INFO] apm-toolkit-log4j-1.x-activation ................... SUCCESS [  0.791 s]
[INFO] apm-toolkit-log4j-2.x-activation ................... SUCCESS [  1.064 s]
[INFO] apm-toolkit-logback-1.x-activation ................. SUCCESS [  1.030 s]
[INFO] apm-toolkit-opentracing ............................ SUCCESS [  0.775 s]
[INFO] apm-toolkit-opentracing-activation ................. SUCCESS [  1.607 s]
[INFO] apm-toolkit-trace-activation ....................... SUCCESS [  1.984 s]
[INFO] apm-toolkit-meter .................................. SUCCESS [  1.839 s]
[INFO] apm-toolkit-meter-activation ....................... SUCCESS [  1.350 s]
[INFO] bootstrap-plugins .................................. SUCCESS [  0.086 s]
[INFO] apm-jdk-http-plugin ................................ SUCCESS [  0.738 s]
[INFO] apm-jdk-threading-plugin ........................... SUCCESS [  0.725 s]
[INFO] optional-plugins ................................... SUCCESS [  0.090 s]
[INFO] optional-spring-plugins ............................ SUCCESS [  0.087 s]
[INFO] apm-spring-annotation-plugin ....................... SUCCESS [  0.745 s]
[INFO] apm-spring-tx-plugin ............................... SUCCESS [  0.747 s]
[INFO] apm-spring-webflux-5.x-plugin ...................... SUCCESS [  0.731 s]
[INFO] optional-spring-cloud .............................. SUCCESS [  0.083 s]
[INFO] gateway-2.0.x-plugin ............................... SUCCESS [  2.007 s]
[INFO] gateway-2.1.x-plugin ............................... SUCCESS [  1.227 s]
[INFO] apm-spring-cloud-gateway-3.x-plugin ................ SUCCESS [  2.475 s]
[INFO] apm-trace-ignore-plugin ............................ SUCCESS [  1.369 s]
[INFO] gson-2.8.x-plugin .................................. SUCCESS [  1.208 s]
[INFO] zookeeper-3.4.x-plugin ............................. SUCCESS [  1.376 s]
[INFO] customize-enhance-plugin ........................... SUCCESS [  1.430 s]
[INFO] kotlin-coroutine-plugin ............................ SUCCESS [  0.635 s]
[INFO] quartz-scheduler-2.x-plugin ........................ SUCCESS [  0.695 s]
[INFO] mybatis-3.x-plugin ................................. SUCCESS [  0.691 s]
[INFO] sentinel-1.x-plugin ................................ SUCCESS [  0.779 s]
[INFO] ehcache-2.x-plugin ................................. SUCCESS [  1.494 s]
[INFO] guava-cache-plugin ................................. SUCCESS [  1.203 s]
[INFO] optional-reporter-plugins .......................... SUCCESS [  0.042 s]
[INFO] kafka-reporter-plugin .............................. SUCCESS [  8.040 s]
[INFO] apm-toolkit-log4j-2.x .............................. SUCCESS [  0.613 s]
[INFO] apm-toolkit-logback-1.x ............................ SUCCESS [  0.647 s]
[INFO] apm-toolkit-micrometer-registry .................... SUCCESS [  1.401 s]
[INFO] apm-toolkit-kafka .................................. SUCCESS [  0.585 s]
[INFO] oap-server ......................................... SUCCESS [  0.190 s]
[INFO] server-library ..................................... SUCCESS [  0.099 s]
[INFO] library-util ....................................... SUCCESS [  2.047 s]
[INFO] library-module ..................................... SUCCESS [  1.725 s]
[INFO] server-telemetry ................................... SUCCESS [  0.116 s]
[INFO] telemetry-api ...................................... SUCCESS [  0.896 s]
[INFO] server-configuration ............................... SUCCESS [  0.148 s]
[INFO] configuration-api .................................. SUCCESS [  1.470 s]
[INFO] library-client ..................................... SUCCESS [  2.876 s]
[INFO] library-server ..................................... SUCCESS [  1.391 s]
[INFO] server-testing ..................................... SUCCESS [  1.151 s]
[INFO] server-core ........................................ SUCCESS [ 12.617 s]
[INFO] analyzer ........................................... SUCCESS [  0.249 s]
[INFO] meter-analyzer ..................................... SUCCESS [  4.983 s]
[INFO] agent-analyzer ..................................... SUCCESS [  3.012 s]
[INFO] log-analyzer ....................................... SUCCESS [  2.837 s]
[INFO] event-analyzer ..................................... SUCCESS [  1.280 s]
[INFO] server-receiver-plugin ............................. SUCCESS [  0.729 s]
[INFO] skywalking-sharing-server-plugin ................... SUCCESS [  1.322 s]
[INFO] skywalking-trace-receiver-plugin ................... SUCCESS [  2.579 s]
[INFO] server-storage-plugin .............................. SUCCESS [  0.098 s]
[INFO] storage-elasticsearch-plugin ....................... SUCCESS [  3.295 s]
[INFO] storage-elasticsearch7-plugin ...................... SUCCESS [  2.531 s]
[INFO] storage-zipkin-elasticsearch7-plugin ............... SUCCESS [  1.852 s]
[INFO] zipkin-receiver-plugin ............................. SUCCESS [  1.430 s]
[INFO] skywalking-mesh-receiver-plugin .................... SUCCESS [  2.139 s]
[INFO] skywalking-management-receiver-plugin .............. SUCCESS [  1.322 s]
[INFO] skywalking-jvm-receiver-plugin ..................... SUCCESS [  1.463 s]
[INFO] receiver-proto ..................................... SUCCESS [ 12.703 s]
[INFO] envoy-metrics-receiver-plugin ...................... SUCCESS [  3.438 s]
[INFO] skywalking-clr-receiver-plugin ..................... SUCCESS [  1.358 s]
[INFO] skywalking-profile-receiver-plugin ................. SUCCESS [  1.369 s]
[INFO] otel-receiver-plugin ............................... SUCCESS [  1.681 s]
[INFO] skywalking-meter-receiver-plugin ................... SUCCESS [  2.210 s]
[INFO] skywalking-browser-receiver-plugin ................. SUCCESS [  2.533 s]
[INFO] skywalking-log-recevier-plugin ..................... SUCCESS [  1.513 s]
[INFO] configuration-discovery-receiver-plugin ............ SUCCESS [  3.054 s]
[INFO] skywalking-event-receiver-plugin ................... SUCCESS [  1.517 s]
[INFO] skywalking-zabbix-receiver-plugin .................. SUCCESS [  3.520 s]
[INFO] server-cluster-plugin .............................. SUCCESS [  0.210 s]
[INFO] cluster-zookeeper-plugin ........................... SUCCESS [  2.823 s]
[INFO] cluster-standalone-plugin .......................... SUCCESS [  1.983 s]
[INFO] cluster-kubernetes-plugin .......................... SUCCESS [  2.670 s]
[INFO] cluster-consul-plugin .............................. SUCCESS [  2.346 s]
[INFO] cluster-etcd-plugin ................................ SUCCESS [  2.328 s]
[INFO] cluster-nacos-plugin ............................... SUCCESS [  2.314 s]
[INFO] storage-jdbc-hikaricp-plugin ....................... SUCCESS [  3.408 s]
[INFO] storage-influxdb-plugin ............................ SUCCESS [  2.367 s]
[INFO] storage-tidb-plugin ................................ SUCCESS [  1.369 s]
[INFO] oal-grammar ........................................ SUCCESS [  1.733 s]
[INFO] oal-rt ............................................. SUCCESS [  2.888 s]
[INFO] server-fetcher-plugin .............................. SUCCESS [  0.113 s]
[INFO] prometheus-fetcher-plugin .......................... SUCCESS [  2.884 s]
[INFO] kafka-fetcher-plugin ............................... SUCCESS [  3.370 s]
[INFO] server-health-checker .............................. SUCCESS [  1.394 s]
[INFO] server-query-plugin ................................ SUCCESS [  0.094 s]
[INFO] query-graphql-plugin ............................... SUCCESS [  3.006 s]
[INFO] server-alarm-plugin ................................ SUCCESS [  5.666 s]
[INFO] telemetry-prometheus ............................... SUCCESS [  1.388 s]
[INFO] exporter ........................................... SUCCESS [  3.468 s]
[INFO] grpc-configuration-sync ............................ SUCCESS [  2.270 s]
[INFO] configuration-apollo ............................... SUCCESS [  2.204 s]
[INFO] configuration-zookeeper ............................ SUCCESS [  2.257 s]
[INFO] configuration-etcd ................................. SUCCESS [  1.943 s]
[INFO] configuration-consul ............................... SUCCESS [  2.248 s]
[INFO] configuration-k8s-configmap ........................ SUCCESS [  2.363 s]
[INFO] configuration-nacos ................................ SUCCESS [  2.106 s]
[INFO] server-bootstrap ................................... SUCCESS [  3.961 s]
[INFO] server-tools ....................................... SUCCESS [  0.151 s]
[INFO] profile-exporter ................................... SUCCESS [  0.159 s]
[INFO] tool-profile-snapshot-server-mock .................. SUCCESS [  1.805 s]
[INFO] tool-profile-snapshot-bootstrap .................... SUCCESS [  3.758 s]
[INFO] tool-profile-snapshot-exporter ..................... SUCCESS [  2.095 s]
[INFO] server-starter ..................................... SUCCESS [  9.989 s]
[INFO] tool-profile-snapshot-exporter-es7 ................. SUCCESS [  2.008 s]
[INFO] server-starter-es7 ................................. SUCCESS [  5.442 s]
[INFO] oap-server-bom ..................................... SUCCESS [  0.040 s]
[INFO] oap-server-bom-es7 ................................. SUCCESS [  0.063 s]
[INFO] apm-webapp ......................................... SUCCESS [  4.027 s]
[INFO] apache-skywalking-apm .............................. SUCCESS [ 13.076 s]
[INFO] apache-skywalking-apm-es7 .......................... SUCCESS [ 13.529 s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time:  07:45 min
[INFO] Finished at: 2023-01-28T17:51:48+08:00
[INFO] ------------------------------------------------------------------------
➜  skywalking git:(rice-v8.7) ✗ 
```

### 源码方式启动oap
(非es存储)
> {skywalking-project-path}/oap-server/server-starter/src/main/java/org/apache/skywalking/oap/server/starter/OAPServerStartUp.java

此时出现
```text
程序包org.apache.skywalking.oap.server.configuration.service不存在
程序包org.apache.skywalking.oap.server.configuration.service不存在
程序包org.apache.skywalking.oap.server.configuration.service不存在
程序包ConfigurationServiceGrpc不存在
```
需要把以下目录生成的源码标记为sources-root
> oap-server/server-configuration/grpc-configuration-sync/target/generated-sources/protobuf

同理，还会报其它包不存在的错误，需标记其它路径为sources-root
- apm-protocol/apm-network/target/generated-sources/protobuf
- oap-server/server-core/target/generated-sources/protobuf
- oap-server/oal-grammar/target/generated-sources
- oap-server/server-receiver-plugin/receiver-proto/target/generated-sources/protobuf
- oap-server/exporter/target/generated-sources/protobuf
- oap-server/server-alarm-plugin/target/generated-sources/protobuf
- 

查看docs/en/guides/How-to-build.md中的（Setting up your IntelliJ IDEA），讲的就是以上这个标记操作。

